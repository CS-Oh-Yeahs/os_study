# os_study 5ì£¼ì°¨ - 02

### â€¼ï¸Â  í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™”ì™€ ê´€ë ¨ëœ 3ê°€ì§€ ë¬¸ì œ

1. Bounded-Buffer Problem
2. Readers and Writers Problem
3. Dining-Philosophers Problem

## 1. Bounded-Buffer Problem (Producer-Consumer Problem)

> Bounded-Buffer Problemë€ ìƒì‚°ìì™€ ì‚¬ìš©ìì˜ ë¹„ìœ¨ì´ ë§ì§€ì•Šì•„ì„œ ì‚¬ìš©ìë‚˜ ìƒì‚°ìê°€ ë¬´í•œíˆ ëŒ€ê¸°í•˜ê±°ë‚˜, ê³µìœ ë°ì´í„°ì— ë™ì‹œì— ì ‘ê·¼í•˜ì—¬ ë°ì´í„° í†µì¼ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆëŠ” ë¬¸ì œì ì„ ì–˜ê¸°í•œë‹¤.
> 
> 
> ì•„ë˜ ë‚´ìš©ì€ ì´ëŸ¬í•œ ë¬¸ì œì ì„ ì„¸ë§ˆí¬ì–´ë¡œ í•´ê²°í•œ ì˜ˆì‹œì´ë‹¤.
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/aa5003b5-c7d6-4c83-9383-441a4f47a220/Untitled.png)

### 1.1 Bounded-Bufferì˜ ë¬¸ì œì  í•´ê²° ë°©ì•ˆ

**âœ”ï¸Â Producer - ë°ì´í„°ë¥¼ ë²„í¼ì— ì±„ì›Œë„£ëŠ” ì—­í• **

1. ë¹„ì–´ìˆëŠ” ë²„í¼ê°€ ìˆëŠ” ì§€ í™•ì¸í•œë‹¤. (ì—†ì„ ê²½ìš° ëŒ€ê¸°)
2. ë¹„ì–´ìˆëŠ” ë²„í¼ê°€ ìˆìœ¼ë©´ ê³µìœ ë°ì´í„°ì— ì ‘ê·¼í•˜ê³  lockì„ ê±´ë‹¤.
3. ë¹„ì–´ìˆëŠ” ë²„í¼ì— ë°ì´í„° ì…ë ¥ ë° ë²„í¼ë¥¼ ì¡°ì‘í•œë‹¤
4. Lockì„ í•´ì œí•œë‹¤.
5. Full Bufferë¥¼ í•˜ë‚˜ ì¦ê°€ì‹œí‚¨ë‹¤.

**âœ”ï¸Â Consumer - ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ì—­í• **

1. full ë²„í¼ê°€ ìˆëŠ” ì§€ í™•ì¸í•œë‹¤. (ì—†ìœ¼ë©´ ëŒ€ê¸°)
2. full ë²„í¼ê°€ ìˆì„ ê²½ìš° ê³µìœ ë°ì´í„°ì— ì ‘ê·¼í•˜ê³  lockì„ ê±´ë‹¤.
3. full ë²„í¼ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ê³  ë²„í¼ë¥¼ ì¡°ì‘í•œë‹¤.
4. Lockì„ í•´ì œí•œë‹¤.
5. Empty Bufferë¥¼ í•˜ë‚˜ ì¦ê°€ì‹œí‚¨ë‹¤.

â€¼ï¸Â  **ì—¬ê¸°ì„œ ë§í•˜ëŠ” ê³µìœ ë°ì´í„°ëŠ”** â€¼ï¸

- Buffer ìì²´ ë° Buffer ì¡°ì‘ ë³€ìˆ˜(empty/full bufferì˜ ì‹œì‘ ìœ„ì¹˜)

### 1.2 ì„¸ë§ˆí¬ì–´ë¥¼ ì ìš©í•œ ë™ê¸°í™” ê¸°ë²• ì˜ˆì œì½”ë“œ

Â **Producer**

**Consumer**

```c
do {
	produce an item in x
	... 
	P(empty); /* ë¹„ì–´ìˆëŠ” ë²„í¼ì˜ ìˆ˜ í™•ì¸ */
	P(mutex); /* ë²„í¼ê°€ ë¹„ì–´ìˆìœ¼ë©´ ë²„í¼ì— ì§„ì…í•˜ê³  lock */ 
	...
	add x to buffer
	...
	V(mutex); /* ë²„í¼ unlock */
	V(full);  /* full ìì›ì„ ì¦ê°€ì‹œí‚´ */

} while(1)
```

```c
do {
	P(full); /* ë¹„ì–´ìˆì§€ì•Šì€ ë²„í¼ì˜ ìˆ˜ í™•ì¸ */
	P(mutex); /* ë²„í¼ê°€ í•˜ë‚˜ë¼ë„ ë¹„ì–´ìˆì§€ ì•Šìœ¼ë©´ ë²„í¼ì— ì§„ì…í•˜ê³  lock */
	...
	remove an item from buffer to y
	...
	V(mutex); /* ë²„í¼ unlock */
	V(empty); /* ë¹„ì–´ìˆëŠ” ë²„í¼ì˜ ê°¯ìˆ˜ ì¦ê°€ */
	...
	consume the item in y
	...
} while(1)
```

âœ”ï¸Â **Synchrozination variables**

- semaphore empty = n; semaphore full = 0;
    - ë‚¨ì€ full/emptyì˜ bufferì˜ ìˆ˜ í‘œì‹œ
- semaphore mutex = 1;
    - ê³µìœ  ë°ì´í„°ì˜ ìƒí˜¸ë°°ì œë¥¼ ìœ„í•œ ë³€ìˆ˜

## 2. Readers and Writers Problem

> ë‹¤ìˆ˜ì˜ Readers Writerê°€ ê³µìš© ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ì—¬ ë°ì´í„° ì¼ê´€ì„±ì„ í•´ì¹˜ëŠ” ë¬¸ì œì ì„ ë§í•œë‹¤. ì´ëŠ” í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™” ê¸°ë²•ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆë‹¤.
> 
> 
> ì•„ë˜ ë‚´ìš©ì€ í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™” ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ í•´ê²°í•œ ì˜ˆì‹œì´ë‹¤.
> 

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/490203f0-898b-4ee3-89ce-57020fcec3fa/Untitled.png)

### 2.1 Readers and Writers ë¬¸ì œì  í•´ê²° ë°©ì•ˆ

**âœ”ï¸Â Reader & Writer**

- ReaderëŠ” ë°ì´í„°ë¥¼ ì½ê¸°ë§Œ í•˜ëŠ” í”„ë¡œì„¸ìŠ¤
- WriterëŠ” ë°ì´í„°ë¥¼ ì½ê³  ìˆ˜ì •í•˜ëŠ” í”„ë¡œì„¸ìŠ¤

**âœ”ï¸Â Reader & Writer Problem ë°©ì§€**

- í•œ Writerê°€ ì„ê³„êµ¬ì—­ì— ì§„ì…í•œ ìƒí™©ì¼ ë•ŒëŠ” ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤ê°€ ì„ê³„êµ¬ì—­ì— ì ‘ê·¼í•˜ê²Œ í•´ì„  ì•ˆëœë‹¤.
    - ì¼ë‹¨ Writerê°€ ê³µìœ ë°ì´í„°ì— ì ‘ê·¼ ì¤‘ì´ë©´ ë‹¤ë¥¸ Writerë‚˜ Readerë“¤ì€ ì ‘ê·¼ì´ ê¸ˆì§€ëœë‹¤.
    - Writerê°€ ê³µìœ ë°ì´í„°ì—ì„œ ë¹ ì ¸ë‚˜ê°€ì•¼ë§Œ Readerì˜ ì ‘ê·¼ì´ í—ˆìš©ëœë‹¤.
- ReaderëŠ” ì—¬ëŸ¿ì´ ì„ê³„êµ¬ì—­ì— ì ‘ê·¼í•´ë„ ëœë‹¤. í•˜ì§€ë§Œ Readerê°€ ì ‘ê·¼ ì¤‘ì¼ ë•Œ Writerê°€ ì ‘ê·¼í•˜ê²Œ í•´ì„  ì•ˆëœë‹¤.
    - WriterëŠ” ëŒ€ê¸° ì¤‘ì¸ Readerê°€ í•˜ë‚˜ë„ ì—†ì„ ë•Œ ê³µìœ ë°ì´í„° ì ‘ê·¼ì´ í—ˆìš©ëœë‹¤.
- Writerê°€ ê³µìœ ë°ì´í„°ì— ì ‘ê·¼ í—ˆê°€ë¥¼ ì•„ì§ ì–»ì§€ ëª»í•œ ìƒíƒœì—ì„œëŠ” ëª¨ë“  ëŒ€ê¸°ì¤‘ì¸ Readerë“¤ì„ ë‹¤ ì„ê³„êµ¬ì—­ì— ì ‘ê·¼í•˜ê²Œ í•´ì¤€ë‹¤

### 2.2 ì„¸ë§ˆí¬ì–´ë¥¼ ì ìš©í•œ ë™ê¸°í™” ê¸°ë²• ì˜ˆì œì½”ë“œ

âœ”ï¸Â  **Shared data**

- int readcount = 0
- DB ìì²´

**âœ”ï¸Â Synchronization variables**

- semaphore mutex = 1;
- semaphore db = 1;

**Writer**

**Reader**

```c
P(db);
...
writing DB is performed 
...
V(db);
```

```c
P(mutex); /* ë™ì‹œì— ë‹¤ë¥¸ readerê°€ readcountë¥¼ ë³€ê²½í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ lock */
readcount++;
if(readcount == 1) P(db); /* ìµœì´ˆì˜ ì ‘ê·¼ì¼ ê²½ìš° writerê°€ ì ‘ê·¼ ëª»í•˜ë„ë¡ db ë´‰ì‡„ */
V(mutex); /* readcount unlock */
```

**â€¼ï¸Â  í•˜ì§€ë§Œ ìœ„ ì½”ë“œì™€ ê°™ì€ í•´ê²°ë°©ë²•ì€ stavation ë°œìƒ ìœ„í—˜ì´ ìˆìŒ** â€¼ï¸Â 

ì˜ˆë¥¼ ë“¤ì–´ writerê°€ ëŒ€ê¸° ì¤‘ì¼ ë•Œ readerê°€ ëˆì„ì—†ì´ ì§„ì…í•˜ê²Œ ë˜ë©´ wrtierê°€ ë¬´í•œíˆ ëŒ€ê¸°í•˜ê²Œ ë˜ëŠ” í˜„ìƒì´ ë°œìƒí•œë‹¤.

ë‹¨ìˆœí•œ í”„ë¡œì„¸ìŠ¤ ë™ê¸°í™” ì˜ˆì œì¼ ë¿ ìµœì ì˜ í•´ê²°ë°©ë²•ì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ì°¸ì¡°ë§Œ í•˜ì.

## 3. Dining-Philosophers Problem (ì‹ì‚¬í•˜ëŠ” ì² í•™ì ë¬¸ì œ)

> í•˜ë‚˜ ì´ìƒì˜ í”„ë¡œì„¸ìŠ¤ê°€ ê³µìœ ë°ì´í„° ì¤‘ ì„œë¡œì—ê²Œ í•„ìš”í•œ ìì›ì„ í•˜ë‚˜ì”©ë§Œ ê°€ì§€ê³  ì–‘ë³´í•˜ì§€ ì•Šì•„ì„œ Deadlock ì´ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œ
> 
> 
> ì•„ë˜ ì˜ˆì œë¥¼ ì°¸ê³ í•˜ì—¬ ì–´ë–¤í•œ ê²½ìš°ì— ë¬¸ì œê°€ ë°œìƒí•˜ëŠ”ì§€ ì•Œì•„ë³´ê³  ì–´ë–»ê²Œ í•´ê²°í•˜ëŠ”ì§€ ì•Œì•„ë³´ì
> 

### **[ë¬¸ì œ ë°œìƒ ì˜ˆì œ ì½”ë“œ]**

**âœ”ï¸Â Synchronization variables**

- semaphore chopstick[5]
    - ë°°ì—´ì˜ ëª¨ë“  ê°’ì„ 1ë¡œ ì´ˆê¸°í™” í–ˆë‹¤ê³  ê°€ì •í•œë‹¤
    

 **Philosopher i**

```c
do {
	P(chopstick[i]);
	P(chopstick[j + 1] % 5);
	...
	eat();
	...
	V(chopstick);
	V(chopstick);
	...
	think();
	...
} while(1);
```

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4f5f30a5-fd0e-462d-b44d-80c349548a8b/Untitled.png)

âœ”ï¸Â  ìœ„ ì˜ˆì œ ì½”ë“œì˜ ë¬¸ì œì 

- ëª¨ë“  ì² í•™ìê°€ ë™ì‹œì— ë°°ê°€ ê³ íŒŒì ¸ ì™¼ìª½ ì “ê°€ë½ì„ ì§‘ì–´ë²„ë¦° ê²½ìš° ì•„ë¬´ë„ ë¨¹ì§€ ëª»í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.
- Deadlock ë°œìƒ ìœ„í—˜ì´ ìˆë‹¤.

### **[í•´ê²°ë°©ì•ˆ ì˜ˆì œ ì½”ë“œ]**

âœ”ï¸Â **Synchronization variables**

- enum {thinking, hungry, eating} state[5];
- semaphore self[5] = 0;
- semaphore mutex = 1;

 **Philosopher i**

```c
/* ì‹¤í–‰ë©”ì†Œë“œ */
do {
	pickup(i);
	eat();
	putdown(i);
	think();
} while (1);

void pickup(int i) {
	P(mutex);
	state[i] = hungry;
	test(i);
	V(mutex);
	P(self[i]);
}

void pickdown(int i) {
	P(mutex);
	state[i] = thinking;
	test((j+4) % 5);
	test((j+1) % 5);
	V(mutex);
}

/* ëŒ€ìƒ ì² í•™ìì˜ ì˜¤ë¥¸ìª½ê³¼ ì™¼ìª½ ì² í•™ìê°€ ì‹ì‚¬ì¤‘ì¸ì§€ ê²€ì‚¬í•˜ê³  ëŒ€ìƒ ì² í•™ìê°€ ë°°ê³ í”ˆ ìƒíƒœì¼ ë•Œ ì‹ì‚¬ë¥¼ í—ˆìš©í•œë‹¤. */
void test(int i) {
	if(state[(j+4) & 5] != eating && state[i] == hungry && state[(i + 1) % 5] != eating ) {
		state[i] = eating;
		V(self[i]);		
	}
}
```

âœ”ï¸Â í•´ê²° ë°©ì•ˆ

- 4ëª…ì˜ ì² í•™ìë§Œì´ í…Œì´ë¸”ì— ë™ì‹œì— ì•‰ì„ ìˆ˜ ìˆë„ë¡ í•œë‹¤
- ì “ê°€ë½ì„ ë‘ ê°œ ëª¨ë‘ ì¡ì„ ìˆ˜ ìˆì„ ë•Œì—ë§Œ ì “ê°€ë½ì„ ì§‘ì„ ìˆ˜ ìˆê²Œ í•œë‹¤
- ë¹„ëŒ€ì¹­
    - ì§ìˆ˜(í™€ìˆ˜) ì² í•™ìëŠ” ì™¼ìª½(ì˜¤ë¥¸ìª½) ì “ê°€ë½ë¶€í„° ì§‘ë„ë¡

### â€¼ï¸Â  ì—¬íƒœê¹Œì§€ì˜ ì˜ˆì œì½”ë“œë¥¼ ì‚´í´ë´¤ì„ ë•Œ Semaphoreì˜ ë¬¸ì œì  â€¼ï¸

- ì½”ë”©í•˜ê¸° í˜ë“¤ë‹¤
- ì •í™•ì„±(correctness)ì˜ ì…ì¦ì´ ì–´ë µë‹¤
- ìë°œì  í˜‘ë ¥(voluntary cooperation)ì´ í•„ìš”í•˜ë‹¤
- í•œë²ˆì˜ ì‹¤ìˆ˜ê°€ ëª¨ë“  ì‹œìŠ¤í…œì— ì¹˜ëª…ì  ì˜í–¥ì„ ë¼ì¹œë‹¤.

ğŸ’¡Â ì˜ˆì‹œ 1ë²ˆ

ğŸ’¡Â ì˜ˆì‹œ 2ë²ˆ

```c
V(mutex)
Critical Section
P(mutex)
```

```c
P(mutex)
Critical Section
P(mutex)
```

**[ì˜ˆì‹œ 1ë²ˆ]**

- Wait ì‹œì ê³¼ Signal ì‹œì ì´ ë°˜ëŒ€ê°€ ë˜ì–´ Mutual Exclusionì´ ê¹¨ì§„ë‹¤.

**[ì˜ˆì‹œ 2ë²ˆ]**

- ìì›ì„ í•´ì œí•˜ëŠ” ì½”ë“œê°€ ì—†ê¸° ë•Œë¬¸ì— ì„œë¡œ í•„ìš”í•œ ìì›ì„ ì–»ì§€ ëª»í•˜ì—¬ Deadlock ë°œìƒ ìœ„í—˜ì´ ìˆë‹¤.
