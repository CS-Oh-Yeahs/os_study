## 데이터의 접근

- 데이터는 데이터가 저장되어 있는 위치에서 읽어와서 연산하고 다시 연산 결과를 저장한다.
- storage-box를 여러 execution-box가 공유하기 때문에 프로세스 동기화 문제가 발생한다.
- 여러 주체(CPU, Process)가 하나의 데이터(Memory, Address Space)에 동시에 접근하려고 할 때 Race condition이 발생할 가능성이 있다.
- Multiprocessor System과 공유메모리를 사용하는 프로세스들, 커널 내부 데이터를 접근하는 루틴들 간에 Race Condition이 발생할 수 있다.

## 운영체제에서 Race Condition이 발생하는 경우

### 1. 커널 수행 중 인터럽트가 발생했을 경우

- 커널 모드로 작업을 수행중일 때, 인터럽트가 발생할 경우 커널은 인터럽트 처리 루틴에 따라 인터럽트를 먼저 처리하게 된다.
- 이를 예방하기 위해 커널 모드에서 데이터를 처리중이었을 경우 인터럽트 처리를 중간에 하지 않는다.

### 2. 프로세스가 시스템 콜을 하여 커널 모드로 수행 중일 때 컨텍스트 스위치가 일어나는 경우

- A프로세스가 시스템 콜을 발생시켜 커널의 코드를 실행하던 중 A프로세스에 할당된 시간이 끝나 CPU가 B프로세스로 넘어갔고, B가 또 시스템 콜을 통해 count라는 값이 1 증가된 후에 다시 A 프로세서가 CPU를 점유하게 되고, 실행된다. 이 경우 count라는 변수가 A와 B에서 각각 한번씩 증가되기 때문에 2가 증가되어야 하는데 A에서 count라는 변수가 증가되던 중에 B로 넘어갔기 때문에 B에서 증가된 값은 반영되지 않게 된다.
- 이러한 문제를 해결하기 위해 프로세스가 커널 모드에 있을 때는 할당 시간이 끝나도 CPU를 뺏기지 않도록 한다. 커널 모드가 끝나고 사용자 모드로 돌아갈 때 뺏는다.

### 3. 멀티프로세서(CPU가 여러 개)에서 공유 메모리 내의 커널 데이터

- 이 경우, 앞의 1, 2번의 경우에 사용했던 해결책이 적합하지 않다.
- 한개의 CPU가 데이터를 사용할 때, 해당 데이터에 lock을 설정한다.
- 한번에 하나의 CPU만이 커널에 접근할 수 있게 한다. 즉, 커널 전체에 lock을 한다.

# Process Synchronization 문제

- 공유 데이터에 동시 접근으로 인해 데이터의 불일치 문제가 발생하는 것
- 데이터의 일관성을 유지하기 위해서는 협력 프로세스간의 실행 순서를 정해주는 메커니즘이 필요하다.
    
    ### Race Condition
    
    - 여러 프로세스들이 동시에 공유 데이터에 접근하는 상황
    - 데이터의 최종 연산 결과는 마지막에 그 데이터를 다룬 프로세스에 따라 달라진다.
- 이를 예방하기 위해서는 concurrent process(동시에 실행되는 프로세스)간의 동기화가 잘 되어야 한다.

### The Critical-Section Problem

- 임계구역
- n개의 프로세스가 공유 데이터를 동시에 사용하기를 원하는 경우
- 각 프로세스의 code segment에는 공유 데이터에 접근하는 코드인 critical section이 존재한다.
- Critical Section : 공유 데이터에 접근하는 코드
- 하나의 프로세스가 critical section에 있을 때 다른 모든 프로세스는 critical section에 들어갈 수 없어야 한다.
